<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
<style>
.my-header {
/*    background: url('../image/mybg.png') no-repeat;*/
    background-size: cover;
    min-height: 220px;
    position: relative;
}
.my-info {
    position: relative;
    padding: 20px 0;
    width: 100%;
    bottom: 0;
    text-align: center;
    vertical-align: center;
}
.my-info img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
}
.my-info p.nickname {
    margin-top: 5px;
    color: #ffffff;
    font-size: 18px;
}
.my-menu {
    position: absolute;
    width: 100%;
    height: 45px;
    line-height: 45px;
    left: 0;
    bottom: 0;
    text-align: center;
    background: #ffffff;
    filter:Alpha(opacity=50);
    background:rgba(255, 255, 255, 0.2) none repeat scroll 0 0 !important;
    color: #ffffff;
    font-size: 14px;
}
.my-menu .aui-col-xs-3 {
    border-right: 1px solid #9bd6d5;
}
.my-menu .aui-col-xs-3:last-child {
    border-right: none;
}
.my-menu > div:active {
    background: #ffffff;
    filter:Alpha(opacity=50);
    background:rgba(255, 255, 255, 0.2) none repeat scroll 0 0 !important;
}
.aui-list-view-cell {
    line-height: 26px;
}
.my-info{
	background-image: url(../image/3601502.jpg);
	background-attachment:fixed;background-repeat:no-repeat;background-size:cover;-moz-background-size:cover;-webkit-background-size:cover;
}
#qixian:active{
    /*background-color:#1abc9c;*/
    background-color:rgba(26,188,156,0.5);
}
#yuyue:active{
    background-color:rgba(26,188,156,0.5);
}
.aui-card1{
    margin-top: 230px;
}
</style>
</head>
<body>
    <div class="aui-content  aui-card1">
    <ul class="aui-grid-nine">
        <li id="yuyue" class="aui-col-xs-6 aui-text-center" tapmode="background-color:rgba(26,188,156,0.5);" onclick="yuyue()">
            <span class="aui-iconfont aui-icon-edit aui-text-primary"></span>
            <p>预约</p>
        </li>
        <li id="qixian" tapmode="background-color:rgba(26,188,156,0.5);" class="aui-col-xs-6 aui-text-center" onclick="qixian()">
            <span class="aui-iconfont aui-icon-remind aui-text-pink"></span>
            <p>期限</p>
        </li>
    </ul>
    </div> 

    <div class="aui-content aui-card">
        <ul class="aui-list-view">
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">个人主页
                </a>
            </li>
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">账号设置</a>
            </li>
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">我的众筹</a>
            </li>
        </ul>
    </div>

    <div class="aui-content aui-card">
        <ul class="aui-list-view">
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">聊天列表
                </a>
            </li>
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">我的好友</a>
            </li>
            <li class="aui-list-view-cell">
                <a class="aui-arrow-right">聊天设置</a>
            </li>
        </ul>
    </div>
    
    <div class="aui-content aui-card">
        <ul class="aui-list-view">
            <li class="aui-list-view-cell aui-switch-body">
                <div class="aui-switch-title">推送提醒</div>
                <input type="checkbox" class="aui-switch aui-pull-right" checked>
            </li>
            <!-- <li class="aui-list-view-cell aui-switch-body">
                <div class="aui-switch-title">自动更新</div>
                <input type="checkbox" class="aui-switch aui-pull-right">
            </li> -->
            <li class="aui-list-view-cell" tapmode="background-color:rgba(26,188,156,0.5);" onclick="update()">
                <a class="aui-arrow-right">检查更新</a>
            </li>
        </ul>
        <ul class="aui-list-view">
            <li class="aui-list-view-cell" tapmode="background-color:rgba(26,188,156,0.5);" onclick="clearCache()">
            <button class="aui-btn aui-btn-info">清除缓存<span class="aui-badge aui-badge-warning" id="cache">12</span></button>
            </li>
<!--             <li class="aui-list-view-cell">
                <a class="aui-arrow-right">使用帮助</a>
            </li> -->
            <li class="aui-list-view-cell aui-switch-body">
            	<button class="aui-btn aui-btn-danger" onclick="loginout();" tapmode="background-color:rgba(26,188,156,0.5);">登录开关</button>
            </li>
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/touxiang.js" ></script>

<script type="text/javascript">
    apiready = function () {
        var name1=$api.byId('name');
        api.getPrefs({
            key:'name'
        },function(ret,err){
            var v =  ret.value;            
            if(v && v != ""){
            // var val = JSON.stringify(v);
            // var vv = v[name];
            $api.text(name1,v);                
            }else{
            $api.text(name1,"未登录");                
                
            }
        });
            var personalCenter = api.require('personalCenter');
            var retname = $api.getStorage('name');
            
            var url = $api.getStorage('touxiangurl');
            personalCenter.open({
                    y:0,
                    h:220,
                    // imgPath:'http://image142-c.poco.cn/mypoco/myphoto/20130806/00/6086776020130806002753064.jpg',
                    imgPath:url,
                    userName:retname,
                    userNameSize:15,
                    userColor:'#FFFFFF',
                    // subTitle:'总借书数:2015',
                    // subTitleSize:13,
                    // subTitleColor:'#FFFFFF',
                    showLeftBtn:false,
                    showRightBtn:false,
                    clearBtn:true,
                    fixedOn:'frame4',
                    fixed:false
                    // placeholderImg: '',
                    // btnArray:[{
                    //     bgImg:'widget://res/personal_btn_nor.png',
                    //     selectedImg:'widget://res/personal_btn_sele.png'
                    // }, {
                    //    bgImg:'widget://res/personal_btn_nor.png',
                    //    selectedImg:'widget://res/personal_btn_sele.png'
                    // }, {
                    //     bgImg:'widget://res/personal_btn_nor.png',
                    //     selectedImg:'widget://res/personal_btn_sele.png'
                    // }]
            }
            ,function(ret,err){
                // api.alert({
                //     msg:ret.click
                // });
                //选手头像图片并上传
                touxiang();
                //更新头像
                // personalCenter.updateValue({
                // imgPath:'http://image142-c.poco.cn/mypoco/myphoto/20130806/00/6086776020130806002753064.jpg',
                // userName:'sunyi',
                // clearBtn:true,
                // subTitle:'总借书数:2016',
                //     subTitleSize:13,
                //     subTitleColor:'#FFFFFF',
                // }); 

            });
    getCacheSize();

    }
        //mechat
        var name = $api.getStorage('name');
        var xuehao = $api.getStorage('xuehao');
        function ZhiChi(){
        var param = {
        enterpriseId:"6755a2531a734082a80ceba2d8e18642",
        customBannerColor:"#f1c40f",
        leftChatColor:"#FFFFFF",
        rightChatColor:"#08b0b0",
        userId:xuehao,
        nickName:name
    };
    var zhichi = api.require('zhiChi');
    zhichi.startZhiChi(param);
    }
        //mechat

    function qixian(){
        api.openWin({
        name: 'qixian_win',
        url: 'qixian_win.html',
        });
    }
    function yuyue(){
           api.toast({
                msg:'预约功能木有上线~~~敬请期待！',
                duration:5000
                });         
    }
        function loginout() {
            api.removePrefs({
                key : "userinfo"
            }, function(ret, err) {
                alert("用户已退出登录");
                api.openWin({
                    name : 'login_win',
                    url : 'login_win.html',
                    pageParam : {
                        name : 'test'
                    }
                });
            });
        } 
        function update(){
            var mam = api.require('mam');
            mam.checkUpdate(function(ret, err){
                if (ret) {
                    var result = ret.result;
                    if (result){
                        var str = '操作成功状态值:'+ret.status+';是否有更新:'+result.update+';设备上当前版本是否被强行关闭:'+result.closed+';新版本型号:'+result.version+';更新描述:'+result.versionDes+';强行关闭提示语:'+result.closeTip+';更新提示语:'+result.updateTip+';下载地址:'+result.source+';发布时间:'+result.time;
                        api.alert({msg:str});
                        api.download({
                                            url: result.source,
                                            report: true
                                        }, function(ret, err){
                                            if(ret && 0 == ret.state){/* 下载进度 */
                                                api.toast({
                                                    msg: "正在下载应用" + ret.percent + "%",
                                                    duration: 2000
                                                });
                                            }

                                            if (ret && 1 == ret.state) {/* 下载完成 */
                                                var savePath = ret.savePath;

                                                api.installApp({
                                                    appUri: savePath
                                                });
                                            }
                                        });
                    }
                } else{
                    api.alert({msg:err.msg});
                }
            });  
        } 
function getCacheSize(){
    api.getCacheSize(function( ret, err ){
    if( ret ){
         // alert( JSON.stringify( ret ) );
         var cache = JSON.stringify( ret.size );
         var cache2 = cache/1024;
         var cache3 = cache2.toFixed(2) + "M";
         var domcache = $api.byId('cache');
         $api.html(domcache,cache3);
    }else{
          var domcache = $api.byId('cache');
         $api.html(domcache,"0M");
    }
});
} 

function clearCache(){
    api.clearCache(function( ret, err ){
    if( ret ){
         // alert( JSON.stringify( ret ) );
         // getCacheSize();
          var domcache = $api.byId('cache');
         $api.html(domcache,"0M");         
    }else{
          var domcache = $api.byId('cache');
         $api.html(domcache,"0M");
    }    
});
} 
</script>
</html>